@using PatrocoalSalesSystem.Models
<section class="content-header">
    <h1>
        Purchases
        <small>Order Details</small>
    </h1>
    <ol class="breadcrumb">
        <li><a href="/home"><i class="fa fa-dashboard"></i> Home</a></li>
        <li><a href="/home"><i class="fa fa-dashboard"></i> Purchase</a></li>
        <li class="active">PO Details</li>
    </ol>
</section>
@{PurchaseOrder ThisPO = ViewBag.ThisPO;}
<!-- Main content -->
<section class="content container-fluid">
    <div class="box box-default box-solid collapsed-box">
        <div class="box-header with-border">
            <h3 class="box-title">Purchase Menu</h3>
            <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse">
                    <i class="fa fa-plus"></i>
                </button>
            </div>
            <!-- /.box-tools -->
        </div>
        <!-- /.box-header -->
        <div class="box-body">
            <div class="col-lg-6">
                <div class="col-sm-3">
                    <a href="/Purchase" class="btn btn-block btn-primary margin">Purchase Orders</a>
                </div>
                <div class="col-sm-3">
                    <a href="/Purchase/GRNList" class="btn btn-block btn-primary margin">GRNs</a>
                </div>
                <div class="col-sm-3">
                    <a href="/Purchase/GRNList?type=loan" class="btn btn-block btn-primary margin">Loan</a>
                </div>
                <div class="col-sm-3">
                    <a href="/Purchase/DCLList" class="btn btn-block btn-primary margin">Duty Clear</a>
                </div>
                <div class="col-sm-3">
                    <a href="/Purchase/CreateOrder" class="btn btn-block btn-primary margin">Create PO</a>
                </div>
                <div class="col-sm-3">
                    <a href="/Purchase/CreateGRN" class="btn btn-block btn-primary margin">Create GRN</a>
                </div>
                <div class="col-sm-3">
                    <a href="/Purchase/CreateGRN?type=loan" class="btn btn-block btn-primary margin">Create LRN</a>
                </div>
                <div class="col-sm-3">
                    <a href="/Purchase/CreateDCL" class="btn btn-block btn-primary margin">Create DCL</a>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="col-sm-3">
                    <a href="/Purchase" class="btn btn-block btn-info margin">Purchase Orders</a>
                </div>

            </div>
        </div>
        <!-- /.box-body -->
    </div>
    <div class="box box-primary box-solid">
        <div class="box-header with-border">
            <h3 class="box-title">Purchase Order: @ThisPO.PONumber</h3>
            <p class="pull-right">Created: @ThisPO.CreatedBy.Name on @ThisPO.CreatedOn.ToShortDateString()</p>
        </div>
        <!-- /.box-header -->
        <div class="box-body">
            <div class="row">

                <div class="col-sm-1">
                    <label>PO No:</label>
                    <p>@ThisPO.PONumber</p>
                </div>
                <div class="col-sm-1">
                    <label>Date:</label>
                    <p>@ThisPO.PODate.ToShortDateString()</p>
                </div>
                <div class="col-sm-1">
                    <label>Target Days:</label>
                    <p>@ThisPO.TargetDays</p>
                </div>
                <div class="col-sm-2">
                    <label>Payment Terms:</label>
                    <p>@ThisPO.TermsOfPayment</p>
                </div>
                <div class="col-sm-1">
                    <label>Lead:</label>
                    <p>@ThisPO.Lead.Name</p>
                </div>
                @*<div class="col-sm-1">
                        <label>Created:</label>
                        <p>@ThisPO.CreatedBy.Name</p>
                    </div>
                    <div class="col-sm-1">
                        <label>Modified:</label>
                        <p>@ThisPO.ModifiedBy.Name</p>
                    </div>*@
                <div class="col-sm-1 pull-right">
                    <span class="badge bg-blue pull-right">@ThisPO.Status</span>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-1">
                    <label>Origin:</label>
                    <p>@ThisPO.Origin.Value</p>
                </div>
                <div class="col-sm-1">
                    <label>Size:</label>
                    <p>@ThisPO.Size.Value</p>
                </div>
                <div class="col-sm-2">
                    <label>Vessel:</label>
                    <p>@ThisPO.Vessel.Value</p>
                </div>
            </div>
            <div class="row">

                <div class="col-lg-12">
                    <table class="table table-condensed">
                        <tbody>
                            <tr>
                                <th>Customer</th>
                                <th>Quantity MT</th>
                                <th>Rate $</th>
                                <th>Allowed Wastage %</th>
                                <th>Cost Per Ton PKR</th>
                                <th>Target Date</th>
                                <th>Recieved MT</th>
                                <th>Pending MT</th>
                                <th>Duty Cleared MT</th>
                                <th>Duty Remaining MT</th>
                                <th>Remarks</th>
                            </tr>
                            @foreach (PODetail pod in ThisPO.PODetailsList)
                            {
                                <tr>
                                    <td>
                                        @if (pod.Customer != null)
                                        {
                                            <a href="/Customer/@pod.Customer.Id">@pod.Customer.Name</a>
                                        }
                                    </td>
                                    <td>
                                        @if (pod.Quantity > 0)
                                        {@pod.Quantity.ToString("#,##,###.000")}
                                    </td>
                                    <td>
                                        $ @if (pod.Rate > 0)
                                        { @pod.Rate.ToString("#,##,###.000")}
                                    </td>
                                    <td>
                                        @if (pod.AllowedWaistage > 0)
                                        {@pod.AllowedWaistage}
                                    </td>
                                    <td>
                                        @if (pod.CostPerTon > 0)
                                        { @pod.CostPerTon.ToString("#,##,###.000")}
                                    </td>
                                    <td>
                                        @if (pod.TargetDate != DateTime.MinValue)
                                        {@pod.TargetDate.ToShortDateString()}
                                    </td>
                                    <td>
                                        @if (pod.Received > 0)
                                        {<span class="badge bg-green">@pod.Received.ToString("#,##,###.000") </span>}
                                    </td>
                                    <td>
                                        @if (pod.Remaining > 0)
                                        {@pod.Remaining.ToString("#,##,###.000") }
                                    </td>
                                    <td>
                                        @if (pod.DutyCleared > 0)
                                        {<span class="badge bg-green">@pod.DutyCleared.ToString("#,##,###.000")</span> }
                                    </td>
                                    <td>
                                        @if (pod.DutyRemaining > 0)
                                        {<span class="badge bg-red">@pod.DutyRemaining.ToString("#,##,###.000")</span> }
                                    </td>
                                    <td>
                                        @if (ThisPO.Origin != null)
                                        {@pod.Remarks}
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <!-- /.box-body -->
        <div class="box-footer">
            <div class="col-sm-6">
                @if (ThisPO.Status == POStatus.Created || ThisPO.Status == POStatus.PendingApproval)
                {
                    <a href="/purchase/UpdateOrder/@ThisPO.PONumber" class="btn btn-primary">Edit</a>
                    <a href="/purchase/UpdateOrder/@ThisPO.PONumber" class="btn btn-success">Approve</a>
                }
                @if (ThisPO.Status == POStatus.InProcess)
                {
                    <a href="/purchase/CompleteOrder/@ThisPO.PONumber" class="btn btn-primary">Complete</a>
                }
                <label>&nbsp;&nbsp;&nbsp;&nbsp;</label>
                @if (ThisPO.Status == POStatus.InProcess)
                {

                    <a href="/purchase/creategrn?po=@ThisPO.PONumber" class="btn btn-success">GRN</a>
                    <a href="/purchase/createdcl?po=@ThisPO.PONumber" class="btn btn-success">Duty Cleared</a>
                }
            </div>
            <div class="col-sm-1 pull-right">
                <span class="badge bg-blue pull-right">@ThisPO.Status</span>
            </div>
        </div>
    </div>
    <!-- /.box -->
    <div class="box box-primary box-solid">
        <div class="box-header with-border">
            <h3 class="box-title">GRNs</h3>
            <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse">
                    <i class="fa fa-minus"></i>
                </button>
            </div>
        </div>
        <!-- /.box-header -->
        <div class="box-body">
            <table class="table table-condensed">
                <tbody>
                    <tr>
                        <th>#</th>
                        <th>Date</th>
                        <th>Store</th>
                        <th>Customer</th>
                        <th>Recieved Quantity</th>
                        <th>Invoice No.</th>
                        <th>Adj. Price</th>
                        <th>Remarks</th>
                        <th>Status</th>
                    </tr>
                    @foreach (PODetail pod in ThisPO.PODetailsList)
                    {
                        foreach (GRN grn in pod.GRNsList)
                        {
                            <tr>
                                <th> @grn.GRNNumber</th>
                                <td>@grn.GRNDate.ToShortDateString()</td>
                                <td><a href="/Stock/Store/@grn.Store.Id">@grn.Store.Name</a></td>
                                <td><a href="/Customer/@pod.Customer.Id">@pod.Customer.Name</a></td>
                                <td>
                                    @if (grn.Quantity > 0)
                                    {<span class="badge bg-green"> @grn.Quantity.ToString("#,##,###.000")</span>}
                                </td>
                                <td>@grn.InvoiceNo</td>
                                <td>@grn.AdjPrice.ToString("#,##,###.000")</td>
                                <td>@grn.Remarks</td>
                                <td>
                                    @switch (grn.Status)
                                    {
                                        case GRNStatus.PendingRecieve:
                                            <span class="badge bg-yellow">New GRN</span>
                                            break;
                                        case GRNStatus.Recieved:
                                            <span class="badge bg-green">Complete</span>
                                            break;
                                        case GRNStatus.Cancelled:
                                            <span class="badge bg-red">Cancelled</span>
                                            break;
                                    }
                                </td>
                                <td>
                                    <a href="/purchase/updategrn/@grn.GRNNumber" class="btn btn-primary btn-sm"><i class="fa fa-edit"></i></a>
                                </td>
                            </tr>
                        }
                    }
                </tbody>
            </table>

            <!-- /.box-body -->
        </div>

    </div>
    <div class="box box-primary box-solid">
        <div class="box-header with-border">
            <h3 class="box-title">Duty Clears</h3>
            <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse">
                    <i class="fa fa-minus"></i>
                </button>
            </div>
        </div>
        <!-- /.box-header -->
        <div class="box-body">
            <table class="table table-condensed">
                <tbody>
                    <tr>
                        <th>#</th>
                        <th>Date</th>
                        <th>Store</th>
                        <th>Customer</th>
                        <th>Quantity Cleared</th>
                        <th>Remarks</th>
                        <th></th>
                    </tr>
                    <tr>
                        @foreach (PODetail pod in ThisPO.PODetailsList)
                        {
                            foreach (DutyClear dcl in pod.DutyClearsList)
                            {
                            <tr>
                                <th>@dcl.DCLNumber</th>
                                <td>@dcl.DCLDate.ToShortDateString()</td>
                                <td><a href="/Stock/Store/@dcl.Store.Id">@dcl.Store.Name</a></td>
                                <td><a href="/Customer/@pod.Customer.Id">@pod.Customer.Name</a></td>
                                <td>
                                    @if (dcl.Quantity > 0)
                                    {<span class="badge bg-green"> @dcl.Quantity.ToString("#,##,###.000")</span>}
                                </td>
                                <td>@dcl.Remarks</td>
                                <td>
                                    <a href="/purchase/updatedcl/@dcl.DCLNumber" class="btn btn-primary btn-sm"><i class="fa fa-edit"></i></a>
                                </td>
                            </tr>
                            }
                        }
                    </tbody>
                </table>

                <!-- /.box-body -->
            </div>

        </div>
    </section>
